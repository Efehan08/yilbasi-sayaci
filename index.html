<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yƒ±lba≈üƒ± Geri Sayƒ±mƒ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

        body {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(-45deg, #0f172a, #1a0b2e, #090979, #020024);
            background-size: 400% 400%;
            animation: auroraGradient 15s ease infinite;
            transition: background-color 0.5s ease;
            overflow: hidden; margin: 0;
        }
        @keyframes auroraGradient { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        
        body.party-mode {
            animation: partyGradient 3s ease infinite !important;
            background: linear-gradient(-45deg, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000);
            background-size: 600% 600%;
        }
        @keyframes partyGradient { 0% {background-position: 0% 50%} 50% {background-position: 100% 50%} 100% {background-position: 0% 50%} }

        #canvas-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; opacity: 1; pointer-events: none;
        }

        #loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 1); z-index: 100;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
            color: #fbbf24; font-size: 24px; font-weight: bold; transition: opacity 0.5s;
            cursor: pointer;
        }

        /* I≈ûIKLAR */
        .icicle-lights-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 45; }
        .light-string { position: absolute; top: 0; width: 2px; background-color: rgba(255, 255, 255, 0.2); }
        .light-bulb-end { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 12px; height: 18px; border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%; background: #fff; animation: flash 1.5s infinite alternate ease-in-out; }
        .light-bulb-end::before, .light-bulb-end::after { content: ''; position: absolute; left: 0; width: 100%; height: 100%; border-radius: inherit; background-color: inherit; box-shadow: inherit; opacity: 0.8; }
        .light-bulb-end::before { bottom: 40px; } .light-bulb-end::after { bottom: 80px; }
        @media (min-width: 1024px) { .light-bulb-end::before { bottom: 10vh; } .light-bulb-end::after { bottom: 20vh; } }
        
        .light-string:nth-child(5n+1) { height: 10vh; left: 5%; animation-delay: 0.1s; }
        .light-string:nth-child(5n+2) { height: 18vh; left: 20%; animation-delay: 0.5s; }
        .light-string:nth-child(5n+3) { height: 8vh; left: 35%; animation-delay: 1.2s; }
        .light-string:nth-child(5n+4) { height: 20vh; left: 50%; animation-delay: 0.3s; }
        .light-string:nth-child(5n+5) { height: 14vh; left: 65%; animation-delay: 0.8s; }
        .light-string:nth-child(n+6) { left: 12%; } .light-string:nth-child(n+11) { left: 28%; } .light-string:nth-child(n+16) { left: 42%; } .light-string:nth-child(n+21) { left: 58%; } .light-string:nth-child(n+26) { left: 75%; } .light-string:nth-child(n+31) { left: 85%; height: 16vh; } .light-string:nth-child(n+36) { left: 95%; height: 9vh; }
        .light-string:nth-child(4n+1) .light-bulb-end { background: #ff3333; color: #ff3333; box-shadow: 0 3px 10px #ff3333; } 
        .light-string:nth-child(4n+2) .light-bulb-end { background: #3366ff; color: #3366ff; box-shadow: 0 3px 10px #3366ff; } 
        .light-string:nth-child(4n+3) .light-bulb-end { background: #33ff33; color: #33ff33; box-shadow: 0 3px 10px #33ff33; } 
        .light-string:nth-child(4n+4) .light-bulb-end { background: #ffcc33; color: #ffcc33; box-shadow: 0 3px 10px #ffcc33; } 
        @keyframes flash { 0%, 100% { opacity: 1; filter: brightness(1.8); box-shadow: 0 3px 20px currentColor; transform: translateX(-50%) scale(1.1); } 50% { opacity: 0.5; filter: brightness(0.8); box-shadow: none; transform: translateX(-50%) scale(0.9); } }

        .neon-box { box-shadow: 0 0 15px rgba(59, 130, 246, 0.2), inset 0 0 15px rgba(59, 130, 246, 0.1); border-color: rgba(59, 130, 246, 0.3) !important; transition: all 0.3s ease; background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(5px); }
        .icy-headline { background: linear-gradient(to right, #ffffff, #cffafe, #38bdf8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 20px rgba(56, 189, 248, 0.8)); display: inline-block; position: relative; z-index: 50; font-size: clamp(24px, 5vw, 60px); line-height: 1.2; }
        
        .celebration-text { animation: zoomInBounce 1s ease-out forwards, heartbeat 1.5s ease-in-out infinite 1s; }
        @keyframes zoomInBounce { 0% { transform: scale(0); opacity: 0; } 60% { transform: scale(1.2); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes heartbeat { 0% { transform: scale(1); } 50% { transform: scale(1.05); text-shadow: 0 0 30px rgba(255,255,255,0.8); } 100% { transform: scale(1); } }

        #spotlight-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at center, transparent 20%, #000000 95%); opacity: 0; transition: opacity 1s ease; pointer-events: none; z-index: 40; }
        body.mode-critical #spotlight-overlay { opacity: 1; }
        body.mode-critical #countdown { z-index: 60; filter: drop-shadow(0 0 50px rgba(255, 255, 255, 0.9)); }
        body.mode-critical #headline-area, body.mode-critical .icicle-lights-container { opacity: 0.1; filter: blur(2px); transition: all 1s ease; }

        .counter-container { transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); position: relative; z-index: 50; }
        .digit { font-variant-numeric: tabular-nums; } .ui-layer { position: relative; z-index: 50; }
        .snowflake { position: absolute; top: -10px; background-color: white; border-radius: 50%; opacity: 0.6; pointer-events: none; animation: snowfall linear forwards; z-index: 2; }
        @keyframes snowfall { to { transform: translateY(110vh); } }

        main { padding-top: 8vh !important; padding-bottom: 10vh !important; }
        @media (min-width: 1024px) { #headline-area { margin-bottom: 3vh !important; } .counter-container { margin-top: 0 !important; } .light-string:nth-child(5n+2) { height: 22vh; } .light-string:nth-child(5n+4) { height: 25vh; } }
        @media (max-width: 768px) { #headline-area { margin-bottom: 2rem; } .icy-headline { font-size: 24px; } .light-string { width: 1px; } .light-bulb-end { width: 8px; height: 12px; } .light-string:nth-child(5n+2) { height: 15vh; } .light-string:nth-child(5n+4) { height: 18vh; } main { padding-top: 10vh !important; } }
    </style>
</head>
<body class="h-screen w-full flex flex-col items-center justify-center text-white relative">

    <div id="loading-screen" onclick="forceOpen()">
        <div>üéÅ Yƒ±lba≈üƒ± Hazƒ±rlƒ±ƒüƒ±...</div>
        <div style="font-size: 12px; color: #999; margin-top: 5px;">(A√ßƒ±lmazsa tƒ±klayƒ±n)</div>
        <button id="skip-btn" onclick="forceOpen()">BA≈ûLAT</button>
    </div>

    <div class="icicle-lights-container">
        <div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div>
        <div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div>
        <div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div>
        <div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div>
        <div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div>
        <div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div>
        <div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div>
        <div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div><div class="light-string"><div class="light-bulb-end"></div></div>
    </div>

    <div id="spotlight-overlay"></div>

    <div id="canvas-container" style="opacity: 1 !important;"></div>
    
    <button id="enableAudioBtn" onclick="enableAudio()" class="ui-layer absolute top-5 right-5 bg-white/10 hover:bg-white/20 backdrop-blur-sm border border-white/20 text-white px-4 py-2 rounded-full text-xs transition">
        üéµ Sesi Aktif Et
    </button>

    <audio id="newYearSong" onerror="playFallback()">
        <source src="mariah_its_time.mp3" type="audio/mpeg">
        <source src="https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg" type="audio/ogg">
    </audio>

    <main class="ui-layer z-10 text-center px-4 w-full flex flex-col items-center justify-center h-full">
        <div id="headline-area" class="relative transition-all duration-1000 ease-in">
            <h1 id="headline" class="tracking-widest uppercase transition-colors duration-300 flex items-center justify-center">
                <span class="icy-headline font-black">Yeni Yƒ±la Kalan Zaman</span>
            </h1>
        </div>

        <div id="countdown" class="counter-container flex flex-wrap justify-center gap-4 md:gap-8 origin-center">
            <div id="box-days" class="neon-box flex flex-col items-center p-3 md:p-4 bg-white/5 rounded-xl md:rounded-2xl backdrop-blur-md border border-white/10 w-20 md:w-40 transition-all duration-500 cursor-default">
                <span id="days" class="digit text-2xl md:text-6xl font-black drop-shadow-lg">00</span>
                <span class="text-[10px] md:text-sm text-blue-200/70 mt-1 md:mt-2">G√úN</span>
            </div>
            <div id="box-hours" class="neon-box flex flex-col items-center p-3 md:p-4 bg-white/5 rounded-xl md:rounded-2xl backdrop-blur-md border border-white/10 w-20 md:w-40 transition-all duration-500 cursor-default">
                <span id="hours" class="digit text-2xl md:text-6xl font-black drop-shadow-lg">00</span>
                <span class="text-[10px] md:text-sm text-blue-200/70 mt-1 md:mt-2">SAAT</span>
            </div>
            <div id="box-minutes" class="neon-box flex flex-col items-center p-3 md:p-4 bg-white/5 rounded-xl md:rounded-2xl backdrop-blur-md border border-white/10 w-20 md:w-40 transition-all duration-500 cursor-default">
                <span id="minutes" class="digit text-2xl md:text-6xl font-black drop-shadow-lg">00</span>
                <span class="text-[10px] md:text-sm text-blue-200/70 mt-1 md:mt-2">DAKƒ∞KA</span>
            </div>
            <div id="box-seconds" class="neon-box flex flex-col items-center p-3 md:p-4 bg-white/5 rounded-xl md:rounded-2xl backdrop-blur-md border border-white/10 w-20 md:w-40 relative overflow-hidden transition-all duration-500 cursor-default">
                <div class="absolute inset-0 bg-red-500/0 transition-colors duration-300" id="seconds-bg"></div>
                <span id="seconds" class="digit text-2xl md:text-6xl font-black relative z-10 text-blue-400 drop-shadow-lg">00</span>
                <span class="text-[10px] md:text-sm text-blue-200/70 mt-1 md:mt-2 relative z-10">SANƒ∞YE</span>
            </div>
        </div>

        <div id="celebration" class="hidden absolute inset-0 flex flex-col items-center justify-center z-50 pointer-events-none">
            <h2 class="celebration-text text-4xl md:text-8xl lg:text-9xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 via-red-500 to-pink-500 text-center px-4 drop-shadow-2xl">
                MUTLU YILLAR!
            </h2>
            <p class="text-xl md:text-4xl mt-4 md:mt-8 text-white/90 animate-pulse font-bold drop-shadow-lg">Ho≈ügeldin 2026</p>
        </div>
    </main>

    <script>
        // --- SAYA√á AYARLARI ---
        const targetDate = new Date("Jan 1, 2026 00:00:00").getTime();
        const elDays = document.getElementById('days'); const elHours = document.getElementById('hours');
        const elMinutes = document.getElementById('minutes'); const elSeconds = document.getElementById('seconds');
        const elContainer = document.getElementById('countdown');
        const elCelebration = document.getElementById('celebration');
        const elHeadlineArea = document.getElementById('headline-area'); 
        const audio = document.getElementById('newYearSong');
        const audioBtn = document.getElementById('enableAudioBtn');
        const loadingScreen = document.getElementById('loading-screen');
        
        const boxDays = document.getElementById('box-days');
        const boxHours = document.getElementById('box-hours');
        const boxMinutes = document.getElementById('box-minutes');

        let audioEnabled = false;
        let musicStarted = false; 
        let audioCtx;
        
        let isCelebrationActive = false;

        function enableAudio() {
            audio.play().then(() => {
                audio.pause(); audio.currentTime = 0; audioEnabled = true;
                if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                audioBtn.innerHTML = "‚úÖ Ses Hazƒ±r";
                setTimeout(() => audioBtn.style.display = 'none', 2000);
            }).catch(e => audioBtn.innerText = "‚ö†Ô∏è ƒ∞zin Verilmedi");
        }

        function playTickSound() {
            if (!audioEnabled || !audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.type = 'sine'; osc.frequency.setValueAtTime(600, audioCtx.currentTime); 
            gainNode.gain.setValueAtTime(0.04, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
            osc.start(); osc.stop(audioCtx.currentTime + 0.05);
        }

        function playFallback() { 
            console.log("Ses dosyasƒ± hatasƒ±, yedek √ßalƒ±nƒ±yor.");
            audio.src = "https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg"; 
        }

        function createSnowflake() {
            const sf = document.createElement('div');
            sf.className = 'snowflake';
            sf.style.left = Math.random() * 100 + 'vw';
            const duration = Math.random() * 3 + 2; 
            sf.style.animationDuration = duration + 's';
            sf.style.width = sf.style.height = (Math.random() * 5 + 2) + 'px';
            document.body.appendChild(sf);
            setTimeout(() => sf.remove(), duration * 1000);
        }
        setInterval(createSnowflake, 100);

        let lastPlayedSecond = -1;

        const timer = setInterval(() => {
            const now = new Date().getTime();
            let distance = targetDate - now;

            if (distance <= 1000 && distance > 0 && !musicStarted && audioEnabled) {
                audio.play().catch(e => {});
                musicStarted = true;
            }

            if (distance < 0) {
                distance = 0;
                clearInterval(timer);
                startCelebration();
                elDays.innerText = "00"; elHours.innerText = "00";
                elMinutes.innerText = "00"; elSeconds.innerText = "00";
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            const totalSecondsLeft = Math.floor(distance / 1000);

            elDays.innerText = days < 10 ? '0' + days : days;
            elHours.innerText = hours < 10 ? '0' + hours : hours;
            elMinutes.innerText = minutes < 10 ? '0' + minutes : minutes;
            elSeconds.innerText = seconds < 10 ? '0' + seconds : seconds;

            boxDays.style.display = days <= 0 ? 'none' : 'flex';
            boxHours.style.display = (days <= 0 && hours <= 0) ? 'none' : 'flex';
            boxMinutes.style.display = (days <= 0 && hours <= 0 && minutes <= 0) ? 'none' : 'flex';

            if (distance > 0 && totalSecondsLeft !== lastPlayedSecond) { playTickSound(); }

            if (totalSecondsLeft <= 10 && totalSecondsLeft > 0) {
                document.body.classList.add('mode-critical');
                if (ambientLight) ambientLight.intensity = 0.2; 
                if (dirLight) dirLight.intensity = 0.5;
            } else {
                document.body.classList.remove('mode-critical');
                if (ambientLight) ambientLight.intensity = 2.5; 
                if (dirLight) dirLight.intensity = 3.0;
            }

            lastPlayedSecond = totalSecondsLeft;

            if (totalSecondsLeft <= 30 && totalSecondsLeft > 20) {
                elContainer.style.transform = "scale(1.2)";
            } else if (totalSecondsLeft <= 20 && totalSecondsLeft > 10) {
                elContainer.style.transform = "scale(1.5)";
            } else if (totalSecondsLeft <= 10 && totalSecondsLeft > 0) {
                elContainer.style.transform = "scale(2.0)";
            } else {
                elContainer.style.transform = "scale(1)";
            }

            if (totalSecondsLeft > 10) { elHeadlineArea.style.opacity = "1"; }
            
            if (distance > 0) {
                if (totalSecondsLeft <= 30 && totalSecondsLeft > 10) {
                    elSeconds.classList.add('text-orange-500');
                } else {
                    elSeconds.classList.remove('text-orange-500');
                }
            }
        }, 100); 

        function startCelebration() {
            document.body.classList.remove('mode-critical');
            document.body.classList.add('party-mode'); 
            if (ambientLight) ambientLight.intensity = 2.5; 
            if (dirLight) dirLight.intensity = 3.0;
            elContainer.style.display = 'none'; 
            elHeadlineArea.style.display = 'none'; 
            elCelebration.classList.remove('hidden'); 
            document.querySelector('.icicle-lights-container').style.display = 'none';
            document.getElementById('spotlight-overlay').style.display = 'none';
            
            isCelebrationActive = true;

            if(sleighGroup) {
                sleighGroup.visible = true;
                sleighProgress = 0; 
            }
            
            var duration = 15 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
            function randomInRange(min, max) { return Math.random() * (max - min) + min; }
            var interval = setInterval(function() {
              var timeLeft = animationEnd - Date.now();
              if (timeLeft <= 0) { return clearInterval(interval); }
              var particleCount = 50 * (timeLeft / duration);
              confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
              confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
            }, 250);
        }

        // --- 3D SAHNE ---
        let scene, camera, renderer, sleighGroup, treeGroup, snowmanModel, snowmanHatModel, lanternModel;
        let ambientLight, dirLight;
        let sleighPath; 
        let sleighProgress = 0; 
        
        // Y√úKLEME SAYACI G√úNCELLENDƒ∞ (13 + 5 yeni obje = 18)
        const totalItemsToLoad = 18; 
        let itemsLoaded = 0;

        function forceOpen() {
            if (loadingScreen.style.display !== 'none') {
                loadingScreen.style.opacity = 0;
                setTimeout(() => loadingScreen.style.display = 'none', 500);
            }
        }
        
        window.addEventListener('load', function() { 
            initThreeJS(); 
            setTimeout(forceOpen, 3000); 
        });

        function checkLoading() {
            itemsLoaded++;
            if(itemsLoaded >= totalItemsToLoad) { forceOpen(); }
        }
        
        function initThreeJS() {
            const container = document.getElementById('canvas-container');
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x1a0b2e, 0.002); 

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 2000);
            camera.position.set(0, 0, 62.3); 
            
            renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.toneMapping = THREE.ReinhardToneMapping;
            container.appendChild(renderer.domElement);

            ambientLight = new THREE.AmbientLight(0xffffff, 2.5); 
            scene.add(ambientLight);
            
            dirLight = new THREE.DirectionalLight(0xffd700, 3.0); 
            dirLight.position.set(20, 50, 20);
            scene.add(dirLight);

            const loader = new THREE.GLTFLoader();

            // --- ZEMƒ∞N KARLARI (MEVCUT) ---
            loader.load('snow-flat-large.glb', function (gltf) {
                const model = gltf.scene; model.scale.set(80, 1, 50); model.position.set(0, -15, 10); scene.add(model); checkLoading();
            }, undefined, function() { checkLoading(); });
            loader.load('snow-pile.glb', function (gltf) { const model = gltf.scene; model.scale.set(4, 4, 4); model.position.set(-22, -14.5, 40); scene.add(model); checkLoading(); });
            loader.load('snow-pile.glb', function (gltf) { const model = gltf.scene; model.scale.set(3, 3, 3); model.position.set(22, -14.5, 38); scene.add(model); checkLoading(); });
            
            // --- YENƒ∞: ARKA PLAN OBJELERƒ∞ ---
            // 1. Sol Arka Aƒüa√ß
            loader.load('tree-snow-a.glb', function (gltf) {
                const model = gltf.scene; model.scale.set(8, 8, 8); model.position.set(-40, -15, -20); scene.add(model); checkLoading();
            }, undefined, function() { checkLoading(); });
            
            // 2. Saƒü Arka Aƒüa√ß
            loader.load('tree-snow-b.glb', function (gltf) {
                const model = gltf.scene; model.scale.set(9, 9, 9); model.position.set(55, -15, -20); scene.add(model); checkLoading();
            }, undefined, function() { checkLoading(); });
            
            // 3. Orta Arka Aƒüa√ß
            loader.load('tree-snow-c.glb', function (gltf) {
                const model = gltf.scene; model.scale.set(7, 7, 7); model.position.set(8, -15, -30); scene.add(model); checkLoading();
            }, undefined, function() { checkLoading(); });
            
            // 4. Sol Arka Kar Yƒ±ƒüƒ±nƒ± (Siper)
            loader.load('snow-bunker.glb', function (gltf) {
                const model = gltf.scene; model.scale.set(7, 7, 7); model.position.set(-23, -15, 10); model.rotation.y = Math.PI / 4; scene.add(model); checkLoading();
            }, undefined, function() { checkLoading(); });
            
            // 5. Saƒü Arka Kar Yƒ±ƒüƒ±nƒ± (Siper)
            loader.load('snow-bunker.glb', function (gltf) {
                const model = gltf.scene; model.scale.set(6, 6, 6); model.position.set(20, -15, 15); model.rotation.y = -Math.PI / 3; scene.add(model); checkLoading();
            }, undefined, function() { checkLoading(); });
            // ---------------------------

            loader.load('tree-decorated-snow.glb', function (gltf) {
                const model = gltf.scene;
                model.scale.set(12.054, 12.054, 12.054); 
                model.position.set(-20.9, -14.08, 34); 
                treeGroup = model; 
                scene.add(model);
                loadGifts(model.position);
                checkLoading(); 
            }, undefined, function() { checkLoading(); });

            loader.load('snowman.glb', function (gltf) {
                snowmanModel = gltf.scene;
                snowmanModel.scale.set(6.615, 6.615, 6.615); 
                snowmanModel.position.set(14, -9.68, 43.9); 
                snowmanModel.rotation.y = -0.8; 
                scene.add(snowmanModel);
                checkLoading();
            }, undefined, function() { checkLoading(); });

            loader.load('lantern.glb', function (gltf) {
                const model = gltf.scene;
                model.scale.set(8.322, 8.322, 8.322);
                model.position.set(20.5, -10, 41.4); 
                scene.add(model);
                checkLoading();
            }, undefined, function() { checkLoading(); });

            sleighGroup = new THREE.Group();
            sleighGroup.visible = false; 
            scene.add(sleighGroup);
            loader.load('sled.glb', function (gltf) {
                const model = gltf.scene; model.scale.set(12, 12, 12); sleighGroup.add(model);
            });
            loader.load('gingerbread-man.glb', function (gltf) {
                const model = gltf.scene; model.scale.set(36, 36, 36); model.position.set(0, 6, 2.0); 
                //model.rotation.y = Math.PI; 
                sleighGroup.add(model);
            });
            loader.load('reindeer.glb', function (gltf) {
                const deer1 = gltf.scene.clone(); deer1.scale.set(12, 12, 12); deer1.position.set(-3, 0, 15); sleighGroup.add(deer1);
                const deer2 = gltf.scene.clone(); deer2.scale.set(12, 12, 12); deer2.position.set(3, 0, 15); sleighGroup.add(deer2);
            });

            const points = [
                new THREE.Vector3(300, 50, -400),
                new THREE.Vector3(100, 20, -100),
                new THREE.Vector3(0, 5, 20),
                new THREE.Vector3(-200, 120, 60)
            ];
            sleighPath = new THREE.CatmullRomCurve3(points);
            
            updateCameraByScreenSize();
            animate3D();
        }

        function loadGifts(treePos) {
            const loader = new THREE.GLTFLoader();
            const giftFiles = ['present-a-cube.glb', 'present-a-rectangle.glb', 'present-b-round.glb'];
            const numGifts = 6; 

            for(let i=0; i < numGifts; i++) {
                const randomFile = giftFiles[Math.floor(Math.random() * giftFiles.length)];
                loader.load(randomFile, function(gltf) {
                    const gift = gltf.scene;
                    gift.scale.set(7, 7, 7);
                    const radius = Math.random() * 4 + 3; 
                    const angle = Math.random() * Math.PI * 2;
                    const posX = treePos.x + radius * Math.cos(angle);
                    const posY = -12.5; 
                    const posZ = (treePos.z + radius * Math.sin(angle)) + 2;
                    gift.position.set(posX, posY, posZ);
                    gift.rotation.y = Math.random() * Math.PI * 2;
                    scene.add(gift);
                    checkLoading(); 
                }, undefined, function() { checkLoading(); });
            }
        }

        function animate3D() {
            requestAnimationFrame(animate3D);
            const currentTime = performance.now();
            const time = currentTime * 0.001; 

            if(treeGroup) { 
                if(isCelebrationActive) {
                    treeGroup.position.y = -14.08 + Math.abs(Math.sin(time * 10)) * 2;
                    treeGroup.scale.set(12.054, 12.054, 12.054); 
                } else {
                    const scaleBase = 12.054;
                    const scale = scaleBase + Math.sin(time) * 0.1; 
                    treeGroup.scale.set(scale, scale, scale); 
                    treeGroup.position.y = -14.08; 
                }
            }
            if(snowmanModel) { 
                if(isCelebrationActive) {
                    snowmanModel.position.y = -9.68 + Math.abs(Math.sin(time * 10)) * 3;
                    snowmanModel.rotation.y += 0.05; 
                } else {
                    snowmanModel.rotation.y = -0.8 + Math.sin(time * 2) * 0.05; 
                }
            }

            if (sleighGroup && sleighGroup.visible) {
                let speed = 0.00218; 
                
                if (sleighProgress > 0.8) {
                    speed = 0.0007; 
                }

                sleighProgress += speed;

                if (sleighProgress >= 1) {
                    sleighGroup.visible = false; 
                } else {
                    const pos = sleighPath.getPoint(sleighProgress);
                    sleighGroup.position.copy(pos);
                    
                    const tangent = sleighPath.getTangent(sleighProgress).normalize();
                    sleighGroup.lookAt(sleighGroup.position.clone().add(tangent));
                }
            }

            renderer.render(scene, camera);
        }

        function updateCameraByScreenSize() {
            if (!camera || !renderer) return;
            const width = window.innerWidth;
            const height = window.innerHeight;
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
            
            if (width < 768) { 
                camera.position.set(0, 10, 110); 
            } else { 
                camera.position.set(0, 0, 62.3); 
            }
        }
        window.addEventListener('resize', updateCameraByScreenSize);
    </script>
</body>
</html>






