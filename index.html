<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YÄ±lbaÅŸÄ± Geri SayÄ±mÄ± - Debug Modu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

        body {
            font-family: 'Orbitron', sans-serif;
            background: #0f172a; /* DÃ¼z renk yapalÄ±m ki modelleri net gÃ¶relim */
            overflow: hidden; 
            margin: 0;
        }

        #canvas-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; opacity: 1; /* Opacity animasyonunu kaldÄ±rdÄ±m, hemen gÃ¶rÃ¼nsÃ¼n */
        }

        .counter-container { position: relative; z-index: 50; }
        
        .neon-box {
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.2), inset 0 0 15px rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3) !important;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(5px);
        }

        .digit { font-variant-numeric: tabular-nums; }
        .ui-layer { position: relative; z-index: 50; }
        
        /* IÅIKLARI GEÃ‡Ä°CÄ° OLARAK GÄ°ZLE (OdaÄŸÄ±mÄ±z 3D Modeller) */
        .icicle-lights-container { display: none; } 

        .icy-headline {
            background: linear-gradient(to right, #ffffff, #cffafe, #38bdf8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 20px rgba(56, 189, 248, 0.8));
            display: inline-block;
            position: relative; z-index: 50;
            font-size: clamp(24px, 5vw, 60px); 
            line-height: 1.2;
        }

        main { padding-top: 15vh !important; padding-bottom: 10vh !important; }
        @media (min-width: 1024px) { #headline-area { margin-bottom: 3vh !important; } .counter-container { margin-top: 0 !important; } }
        @media (max-width: 768px) { #headline-area { margin-bottom: 2rem; } .icy-headline { font-size: 24px; } }
    </style>
</head>
<body class="h-screen w-full flex flex-col items-center justify-center text-white relative">

    <div id="canvas-container"></div>
    
    <button id="enableAudioBtn" onclick="enableAudio()" class="ui-layer absolute top-5 right-5 bg-white/10 hover:bg-white/20 backdrop-blur-sm border border-white/20 text-white px-4 py-2 rounded-full text-xs transition">
        ğŸµ Sesi Aktif Et
    </button>

    <audio id="newYearSong" onerror="playFallback()">
        <source src="mariah_its_time.mp3" type="audio/mpeg">
        <source src="https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg" type="audio/ogg">
    </audio>

    <main class="ui-layer z-10 text-center px-4 w-full flex flex-col items-center justify-center h-full">
        <div id="headline-area" class="relative transition-all duration-1000 ease-in">
            <h1 id="headline" class="tracking-widest uppercase transition-colors duration-300 flex items-center justify-center">
                <span class="icy-headline font-black">Yeni YÄ±la Kalan Zaman</span>
            </h1>
        </div>

        <div id="countdown" class="counter-container flex flex-wrap justify-center gap-4 md:gap-8 origin-center">
            <div id="box-days" class="neon-box flex flex-col items-center p-3 md:p-4 bg-white/5 rounded-xl md:rounded-2xl backdrop-blur-md border border-white/10 w-20 md:w-40 transition-all duration-500 cursor-default">
                <span id="days" class="digit text-2xl md:text-6xl font-black drop-shadow-lg">00</span>
                <span class="text-[10px] md:text-sm text-blue-200/70 mt-1 md:mt-2">GÃœN</span>
            </div>
            <div id="box-hours" class="neon-box flex flex-col items-center p-3 md:p-4 bg-white/5 rounded-xl md:rounded-2xl backdrop-blur-md border border-white/10 w-20 md:w-40 transition-all duration-500 cursor-default">
                <span id="hours" class="digit text-2xl md:text-6xl font-black drop-shadow-lg">00</span>
                <span class="text-[10px] md:text-sm text-blue-200/70 mt-1 md:mt-2">SAAT</span>
            </div>
            <div id="box-minutes" class="neon-box flex flex-col items-center p-3 md:p-4 bg-white/5 rounded-xl md:rounded-2xl backdrop-blur-md border border-white/10 w-20 md:w-40 transition-all duration-500 cursor-default">
                <span id="minutes" class="digit text-2xl md:text-6xl font-black drop-shadow-lg">00</span>
                <span class="text-[10px] md:text-sm text-blue-200/70 mt-1 md:mt-2">DAKÄ°KA</span>
            </div>
            <div id="box-seconds" class="neon-box flex flex-col items-center p-3 md:p-4 bg-white/5 rounded-xl md:rounded-2xl backdrop-blur-md border border-white/10 w-20 md:w-40 relative overflow-hidden transition-all duration-500 cursor-default">
                <div class="absolute inset-0 bg-red-500/0 transition-colors duration-300" id="seconds-bg"></div>
                <span id="seconds" class="digit text-2xl md:text-6xl font-black relative z-10 text-blue-400 drop-shadow-lg">00</span>
                <span class="text-[10px] md:text-sm text-blue-200/70 mt-1 md:mt-2 relative z-10">SANÄ°YE</span>
            </div>
        </div>
        <div style="margin-top: 20px; font-size: 12px; color: yellow;" id="debug-log">3D YÃ¼kleniyor...</div>
    </main>

    <script>
        // --- SAYAÃ‡ AYARLARI ---
        const targetDate = new Date("Jan 1, 2026 00:00:00").getTime();
        const elDays = document.getElementById('days'); const elHours = document.getElementById('hours');
        const elMinutes = document.getElementById('minutes'); const elSeconds = document.getElementById('seconds');
        const boxDays = document.getElementById('box-days'); const boxHours = document.getElementById('box-hours');
        const boxMinutes = document.getElementById('box-minutes');
        const elContainer = document.getElementById('countdown');
        const audio = document.getElementById('newYearSong');
        const audioBtn = document.getElementById('enableAudioBtn');
        const debugLog = document.getElementById('debug-log');

        let audioEnabled = false;
        let musicStarted = false; 
        let audioCtx;

        function enableAudio() {
            audio.play().then(() => {
                audio.pause(); audio.currentTime = 0; audioEnabled = true;
                if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                audioBtn.innerHTML = "âœ… Ses HazÄ±r";
                setTimeout(() => audioBtn.style.display = 'none', 2000);
            }).catch(e => audioBtn.innerText = "âš ï¸ Ä°zin Verilmedi");
        }

        function playTickSound() {
            if (!audioEnabled || !audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.type = 'sine'; osc.frequency.setValueAtTime(600, audioCtx.currentTime); 
            gainNode.gain.setValueAtTime(0.04, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
            osc.start(); osc.stop(audioCtx.currentTime + 0.05);
        }

        function playFallback() { 
            console.log("Ses dosyasÄ± hatasÄ±, yedek Ã§alÄ±nÄ±yor.");
            audio.src = "https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg"; 
        }

        let lastPlayedSecond = -1;
        const timer = setInterval(() => {
            const now = new Date().getTime();
            const distance = targetDate - now;
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            const totalSecondsLeft = Math.floor(distance / 1000);

            elDays.innerText = days < 10 ? '0' + days : days;
            elHours.innerText = hours < 10 ? '0' + hours : hours;
            elMinutes.innerText = minutes < 10 ? '0' + minutes : minutes;
            elSeconds.innerText = seconds < 10 ? '0' + seconds : seconds;

            boxDays.style.display = days <= 0 ? 'none' : 'flex';
            boxHours.style.display = (days <= 0 && hours <= 0) ? 'none' : 'flex';
            boxMinutes.style.display = (days <= 0 && hours <= 0 && minutes <= 0) ? 'none' : 'flex';

            if (distance > 0 && totalSecondsLeft !== lastPlayedSecond) { playTickSound(); }
            lastPlayedSecond = totalSecondsLeft;

            if (totalSecondsLeft <= 30 && totalSecondsLeft > 20) { elContainer.style.transform = "scale(1.2)"; } 
            else if (totalSecondsLeft <= 20 && totalSecondsLeft > 10) { elContainer.style.transform = "scale(1.5)"; } 
            else if (totalSecondsLeft <= 10 && totalSecondsLeft > 0) { elContainer.style.transform = "scale(2.0)"; } 
            else { elContainer.style.transform = "scale(1)"; }

            if (distance > 0) {
                if (distance <= 1500 && !musicStarted) {
                    if (audioEnabled) { audio.play().catch(e => {}); }
                    musicStarted = true;
                }
            } else { clearInterval(timer); }
        }, 100); 

        // --- 3D DÃœNYASI (DEBUG MODU) ---
        let scene, camera, renderer, treeGroup;
        let ambientLight, dirLight;
        
        function initThreeJS() {
            const container = document.getElementById('canvas-container');
            
            // 1. Sahne Kurulumu
            scene = new THREE.Scene();
            // Sis'i kaldÄ±rdÄ±m ki her ÅŸey net gÃ¶rÃ¼nsÃ¼n
            // scene.fog = new THREE.FogExp2(0x0f172a, 0.002); 

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            // KamerayÄ± biraz daha yukarÄ± ve geri alÄ±yoruz
            camera.position.set(0, 10, 60); 
            
            renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.toneMapping = THREE.ReinhardToneMapping;
            container.appendChild(renderer.domElement);

            // 2. YARDIMCI ARAÃ‡LAR (GRID & AXES)
            // KÄ±rmÄ±zÄ± Ã§izgi X, YeÅŸil Y, Mavi Z eksenidir.
            const gridHelper = new THREE.GridHelper(100, 10);
            scene.add(gridHelper);
            const axesHelper = new THREE.AxesHelper(15);
            scene.add(axesHelper);

            // 3. IÅŸÄ±klar (GÃ¼Ã§lendirildi)
            ambientLight = new THREE.AmbientLight(0xffffff, 3.0); // Ã‡ok parlak
            scene.add(ambientLight);
            
            dirLight = new THREE.DirectionalLight(0xffd700, 4.5); 
            dirLight.position.set(20, 50, 20);
            scene.add(dirLight);

            // 4. Modelleri YÃ¼kle (Hata AyÄ±klayÄ±cÄ± ile)
            const loader = new THREE.GLTFLoader();

            // AÄAÃ‡ YÃœKLEME
            debugLog.innerText = "AÄŸaÃ§ dosyasÄ± aranÄ±yor...";
            
            loader.load('tree-decorated-snow.glb', 
                function (gltf) {
                    // BAÅARILI
                    console.log('âœ… AÄAÃ‡ YÃœKLENDÄ°!');
                    debugLog.innerText = "âœ… AÄŸaÃ§ YÃ¼klendi! (Ekranda gÃ¶rÃ¼nmeli)";
                    
                    const model = gltf.scene;
                    model.scale.set(15, 15, 15);
                    // Merkeze koyalÄ±m (0,0,0) ki Ä±zgaranÄ±n ortasÄ±nda gÃ¶rebilelim
                    model.position.set(-20, 0, 0); 
                    scene.add(model);
                },
                function (xhr) {
                    // YÃœKLENÄ°YOR
                    console.log((xhr.loaded / xhr.total * 100) + '% yÃ¼klendi');
                },
                function (error) {
                    // HATA
                    console.error('âŒ HATA:', error);
                    debugLog.innerText = "âŒ HATA: AÄŸaÃ§ bulunamadÄ±! (Konsola bak)";
                    debugLog.style.color = "red";
                }
            );

            // KARDAN ADAM YÃœKLEME
            loader.load('snowman.glb', function (gltf) {
                console.log('âœ… Kardan Adam YÃ¼klendi!');
                const model = gltf.scene;
                model.scale.set(10, 10, 10);
                model.position.set(20, 0, 0); // SaÄŸ tarafa
                scene.add(model);
            });

            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        function updateCameraByScreenSize() {
            if (!camera || !renderer) return;
            const width = window.innerWidth;
            const height = window.innerHeight;
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
        }
        window.addEventListener('resize', updateCameraByScreenSize);

        // BaÅŸlat
        initThreeJS();
    </script>
</body>
</html>
