<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yƒ±lba≈üƒ± Geri Sayƒ±mƒ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

        body {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(-45deg, #0f172a, #1a0b2e, #090979, #020024);
            background-size: 400% 400%;
            animation: auroraGradient 15s ease infinite;
            transition: background-color 0.5s ease;
            overflow: hidden; 
            margin: 0;
        }

        @keyframes auroraGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        #canvas-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1; opacity: 0; transition: opacity 2s ease-in; pointer-events: none;
        }

        .counter-container { 
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); 
            position: relative; z-index: 10; 
        }
        
        .neon-box {
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.2), inset 0 0 15px rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3) !important;
            transition: all 0.3s ease;
        }
        .neon-box:hover {
             box-shadow: 0 0 30px rgba(96, 165, 250, 0.6), inset 0 0 20px rgba(96, 165, 250, 0.4);
             border-color: rgba(96, 165, 250, 0.7) !important;
             transform: translateY(-5px) scale(1.03);
        }

        /* SPOT I≈ûIƒûI */
        #spotlight-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, transparent 20%, #000000 95%);
            opacity: 0; transition: opacity 1s ease; 
            pointer-events: none; z-index: 25; 
        }

        body.mode-critical #spotlight-overlay { opacity: 1; }
        
        body.mode-critical #countdown {
            z-index: 30; 
            filter: drop-shadow(0 0 50px rgba(255, 255, 255, 0.9)); 
        }

        body.mode-critical #headline-area,
        body.mode-critical .tree-container,
        body.mode-critical .gift-stack-container {
            opacity: 0.1; filter: blur(2px); transition: all 1s ease;
        }

        .digit { font-variant-numeric: tabular-nums; }
        .ui-layer { position: relative; z-index: 50; }
        
        .snowflake {
            position: absolute; top: -10px; background-color: white; border-radius: 50%; opacity: 0.8; pointer-events: none;
            animation: snowfall linear forwards; z-index: 2; 
        }
        @keyframes snowfall { to { transform: translateY(110vh); } }

        .magic-dust {
            position: fixed; width: 6px; height: 6px; background: transparent;
            box-shadow: 0 0 10px 3px #60a5fa, 0 0 20px 5px #a855f7;
            border-radius: 50%; pointer-events: none; z-index: 100;
            animation: fadeOutDust 1s forwards;
        }
        @keyframes fadeOutDust { to { transform: scale(0); opacity: 0; } }

        .icy-headline {
            background: linear-gradient(to right, #ffffff, #cffafe, #38bdf8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 20px rgba(56, 189, 248, 0.8));
            display: inline-block;
        }

        /* DEKORASYONLAR */
        .tree-container {
            position: fixed; bottom: -50px; left: -40px; font-size: 350px; z-index: 20;
            filter: drop-shadow(0 0 40px rgba(0, 255, 0, 0.3)); pointer-events: none; line-height: 1; transition: opacity 1s;
        }
        .gift-stack-container {
            position: fixed; bottom: 0; right: 10px; display: flex; align-items: flex-end; gap: -10px; z-index: 30; transition: opacity 1s;
        }
        .gift-column { display: flex; flex-direction: column-reverse; margin-left: -15px; }
        .gift-item {
            font-size: 80px; line-height: 0.75; cursor: pointer; transition: transform 0.2s; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.5));
        }
        .gift-item:hover { transform: scale(1.1) translateY(-5px); z-index: 40; }
        .col-1 .gift-item { filter: hue-rotate(200deg); } 
        .col-2 .gift-item { filter: hue-rotate(90deg); }  
        .col-3 .gift-item { filter: hue-rotate(280deg); } 
        .col-4 .gift-item { filter: none; }               
        
        @keyframes giftPopIn {
            0% { transform: scale(0); opacity: 0; }
            80% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .gift-respawn { animation: giftPopIn 0.6s ease-out forwards; }

        @media (max-width: 768px) {
            .tree-container { font-size: 180px; left: -30px; bottom: -20px; }
            .gift-item { font-size: 50px; }
            .gift-stack-container { right: 0; }
            .col-1, .col-2 { display: none; }
        }
    </style>
</head>
<body class="h-screen w-full flex flex-col items-center justify-center text-white relative">

    <div id="spotlight-overlay"></div>
    <div class="tree-container">üéÑ</div>
    
    <div class="gift-stack-container">
        <div class="gift-column col-1"><span class="gift-item">üéÅ</span></div>
        <div class="gift-column col-2"><span class="gift-item">üéÅ</span><span class="gift-item">üéÅ</span></div>
        <div class="gift-column col-3"><span class="gift-item">üéÅ</span><span class="gift-item">üéÅ</span><span class="gift-item">üéÅ</span></div>
        <div class="gift-column col-4"><span class="gift-item">üéÅ</span><span class="gift-item">üéÅ</span><span class="gift-item">üéÅ</span><span class="gift-item">üéÅ</span></div>
    </div>

    <div id="canvas-container"></div>
    
    <button id="enableAudioBtn" onclick="enableAudio()" class="ui-layer absolute top-5 right-5 bg-white/10 hover:bg-white/20 backdrop-blur-sm border border-white/20 text-white px-4 py-2 rounded-full text-xs transition">
        üéµ Sesi Aktif Et
    </button>

    <audio id="newYearSong" onerror="playFallback()">
        <source src="mariah_its_time.mp3" type="audio/mpeg">
        <source src="https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg" type="audio/ogg">
    </audio>

    <main class="ui-layer z-10 text-center px-4 w-full flex flex-col items-center justify-center h-full">
        <div id="headline-area" class="relative mb-5 md:mb-10 transition-all duration-1000 ease-in">
            <h1 id="headline" class="text-2xl md:text-5xl tracking-widest uppercase transition-colors duration-300 flex items-center justify-center">
                <span class="icy-headline font-black">Yeni Yƒ±la Kalan Zaman</span>
            </h1>
        </div>

        <div id="countdown" class="counter-container flex flex-wrap justify-center gap-4 md:gap-8 origin-center mt-5 md:mt-10">
            <div id="box-days" class="neon-box flex flex-col items-center p-3 md:p-4 bg-white/5 rounded-xl md:rounded-2xl backdrop-blur-md border border-white/10 w-20 md:w-40 transition-all duration-500 cursor-default">
                <span id="days" class="digit text-2xl md:text-6xl font-black drop-shadow-lg">00</span>
                <span class="text-[10px] md:text-sm text-blue-200/70 mt-1 md:mt-2">G√úN</span>
            </div>
            <div id="box-hours" class="neon-box flex flex-col items-center p-3 md:p-4 bg-white/5 rounded-xl md:rounded-2xl backdrop-blur-md border border-white/10 w-20 md:w-40 transition-all duration-500 cursor-default">
                <span id="hours" class="digit text-2xl md:text-6xl font-black drop-shadow-lg">00</span>
                <span class="text-[10px] md:text-sm text-blue-200/70 mt-1 md:mt-2">SAAT</span>
            </div>
            <div id="box-minutes" class="neon-box flex flex-col items-center p-3 md:p-4 bg-white/5 rounded-xl md:rounded-2xl backdrop-blur-md border border-white/10 w-20 md:w-40 transition-all duration-500 cursor-default">
                <span id="minutes" class="digit text-2xl md:text-6xl font-black drop-shadow-lg">00</span>
                <span class="text-[10px] md:text-sm text-blue-200/70 mt-1 md:mt-2">DAKƒ∞KA</span>
            </div>
            <div id="box-seconds" class="neon-box flex flex-col items-center p-3 md:p-4 bg-white/5 rounded-xl md:rounded-2xl backdrop-blur-md border border-white/10 w-20 md:w-40 relative overflow-hidden transition-all duration-500 cursor-default">
                <div class="absolute inset-0 bg-red-500/0 transition-colors duration-300" id="seconds-bg"></div>
                <span id="seconds" class="digit text-2xl md:text-6xl font-black relative z-10 text-blue-400 drop-shadow-lg">00</span>
                <span class="text-[10px] md:text-sm text-blue-200/70 mt-1 md:mt-2 relative z-10">SANƒ∞YE</span>
            </div>
        </div>

        <div id="celebration" class="hidden absolute inset-0 flex flex-col items-center justify-center z-50 pointer-events-none">
            <h2 class="text-4xl md:text-8xl lg:text-9xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 via-red-500 to-pink-500 animate-bounce text-center px-4 drop-shadow-2xl">
                MUTLU YILLAR!
            </h2>
            <p class="text-xl md:text-4xl mt-4 md:mt-8 text-white/90 animate-pulse font-bold drop-shadow-lg">Ho≈ügeldin 2026</p>
        </div>
    </main>

    <script>
        // --- SAYA√á AYARLARI ---
        const targetDate = new Date("Nov 29, 2025 23:12:00").getTime();
        // TEST ƒ∞√áƒ∞N (45 sn sonra yƒ±lba≈üƒ±):
        // const targetDate = new Date().getTime() + 45000; 

        const elDays = document.getElementById('days'); const elHours = document.getElementById('hours');
        const elMinutes = document.getElementById('minutes'); const elSeconds = document.getElementById('seconds');
        const boxDays = document.getElementById('box-days'); const boxHours = document.getElementById('box-hours');
        const boxMinutes = document.getElementById('box-minutes');
        const elContainer = document.getElementById('countdown');
        const elCelebration = document.getElementById('celebration');
        const elHeadlineArea = document.getElementById('headline-area'); 
        const audio = document.getElementById('newYearSong');
        const audioBtn = document.getElementById('enableAudioBtn');

        let audioEnabled = false;
        let musicStarted = false; 
        let audioCtx;

        function enableAudio() {
            audio.play().then(() => {
                audio.pause(); audio.currentTime = 0; audioEnabled = true;
                if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                audioBtn.innerHTML = "‚úÖ Ses Hazƒ±r";
                setTimeout(() => audioBtn.style.display = 'none', 2000);
            }).catch(e => audioBtn.innerText = "‚ö†Ô∏è ƒ∞zin Verilmedi");
        }

        // Tƒ∞K SESƒ∞ (Hafifletilmi≈ü - 0.04)
        function playTickSound() {
            if (!audioEnabled || !audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            osc.type = 'sine'; 
            osc.frequency.setValueAtTime(600, audioCtx.currentTime); 
            
            // --- SES SEVƒ∞YESƒ∞ 0.04 OLARAK AYARLANDI ---
            gainNode.gain.setValueAtTime(0.04, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
            
            osc.start();
            osc.stop(audioCtx.currentTime + 0.05);
        }

        function playFallback() { 
            console.log("Ses dosyasƒ± hatasƒ±, yedek √ßalƒ±nƒ±yor.");
            audio.src = "https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg"; 
        }

        function createSnowflake() {
            const sf = document.createElement('div');
            sf.className = 'snowflake';
            sf.style.left = Math.random() * 100 + 'vw';
            sf.style.animationDuration = (Math.random() * 3 + 2) + 's';
            sf.style.width = sf.style.height = (Math.random() * 5 + 2) + 'px';
            document.body.appendChild(sf);
            setTimeout(() => sf.remove(), 5000);
        }
        setInterval(createSnowflake, 100);

        let lastPlayedSecond = -1;

        const timer = setInterval(() => {
            const now = new Date().getTime();
            const distance = targetDate - now;

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            const totalSecondsLeft = Math.floor(distance / 1000);

            elDays.innerText = days < 10 ? '0' + days : days;
            elHours.innerText = hours < 10 ? '0' + hours : hours;
            elMinutes.innerText = minutes < 10 ? '0' + minutes : minutes;
            elSeconds.innerText = seconds < 10 ? '0' + seconds : seconds;

            boxDays.style.display = days <= 0 ? 'none' : 'flex';
            boxHours.style.display = (days <= 0 && hours <= 0) ? 'none' : 'flex';
            boxMinutes.style.display = (days <= 0 && hours <= 0 && minutes <= 0) ? 'none' : 'flex';

            // --- ETKƒ∞LE≈ûƒ∞M MANTIƒûI ---
            
            // S√úREKLƒ∞ Tƒ∞K SESƒ∞
            if (distance > 0 && totalSecondsLeft !== lastPlayedSecond) {
                playTickSound();
            }

            if (totalSecondsLeft <= 10 && totalSecondsLeft > 0) {
                document.body.classList.add('mode-critical');
                if (ambientLight) ambientLight.intensity = 0.2; 
                if (dirLight) dirLight.intensity = 0.5;
            } else {
                document.body.classList.remove('mode-critical');
                if (ambientLight) ambientLight.intensity = 2.0; 
                if (dirLight) dirLight.intensity = 2.5;
            }

            lastPlayedSecond = totalSecondsLeft;

            // SCALE EFEKTƒ∞
            if (totalSecondsLeft <= 30 && totalSecondsLeft > 20) {
                elContainer.style.transform = "scale(1.2)";
            } else if (totalSecondsLeft <= 20 && totalSecondsLeft > 10) {
                elContainer.style.transform = "scale(1.5)";
            } else if (totalSecondsLeft <= 10 && totalSecondsLeft > 0) {
                elContainer.style.transform = "scale(2.0)";
            } else {
                elContainer.style.transform = "scale(1)";
            }

            if (totalSecondsLeft > 10) {
                 elHeadlineArea.style.opacity = "1";
            }
            
            if (distance > 0) {
                if (distance <= 1500 && !musicStarted) {
                    if (audioEnabled) { audio.play().catch(e => {}); }
                    musicStarted = true;
                }
                if (totalSecondsLeft <= 30 && totalSecondsLeft > 10) {
                    elSeconds.classList.add('text-orange-500');
                } else {
                    elSeconds.classList.remove('text-orange-500');
                }
            } else {
                clearInterval(timer);
                startCelebration();
            }
        }, 100); 

        function startCelebration() {
            document.body.classList.remove('mode-critical');
            if (ambientLight) ambientLight.intensity = 2.0; 
            if (dirLight) dirLight.intensity = 2.5;
            
            document.body.style.background = "#1a0b2e"; 
            
            elContainer.style.display = 'none'; 
            elHeadlineArea.style.display = 'none'; 
            elCelebration.classList.remove('hidden'); 
            document.querySelector('.tree-container').style.display = 'none';
            document.querySelector('.gift-stack-container').style.display = 'none';
            document.getElementById('spotlight-overlay').style.display = 'none';
            
            var duration = 15 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
            var interval = setInterval(function() {
                var timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) return clearInterval(interval);
                confetti(Object.assign({}, defaults, { particleCount: 50 * (timeLeft / duration), origin: { x: Math.random(), y: Math.random() - 0.2 } }));
            }, 250);

            if(audioEnabled && !musicStarted) { audio.play(); }

            // --- KUTLAMA MODUNU BA≈ûLAT (Zafer Turu & Havai Fi≈üekler) ---
            initCelebrationMode();
        }

        // --- 3D D√úNYASI ---
        let scene, camera, renderer, sleighGroup;
        let ambientLight, dirLight;
        let clock = new THREE.Clock();
        
        let entryPath, exitPath, victoryPath;
        let pathDuration = 20; 
        let animationStartTime = 0;
        let animationState = 0; 
        let waitStartTime = 0;
        let isCelebration = false;
        let fireworks = []; // Havai fi≈üekler i√ßin dizi

        function initThreeJS() {
            const container = document.getElementById('canvas-container');
            container.style.opacity = 1;

            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x1a0b2e, 0.002); 

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            
            renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.toneMapping = THREE.ReinhardToneMapping;
            container.appendChild(renderer.domElement);

            ambientLight = new THREE.AmbientLight(0xffffff, 2.0); 
            scene.add(ambientLight);
            
            dirLight = new THREE.DirectionalLight(0xffd700, 2.5); 
            dirLight.position.set(20, 50, 20);
            scene.add(dirLight);

            const starGeo = new THREE.BufferGeometry();
            const starPos = new Float32Array(3000);
            for(let i=0; i<3000; i++) starPos[i] = (Math.random() - 0.5) * 400;
            starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
            scene.add(new THREE.Points(starGeo, new THREE.PointsMaterial({color: 0xffffff, size: 0.5})));

            sleighGroup = new THREE.Group();
            scene.add(sleighGroup);

            const loader = new THREE.GLTFLoader();
            const modelScale = 12;

            loader.load('sled.glb', function (gltf) {
                const model = gltf.scene;
                model.rotation.y = 0; 
                model.scale.set(modelScale, modelScale, modelScale); 
                sleighGroup.add(model);
            });

            loader.load('gingerbread-man.glb', function (gltf) {
                const model = gltf.scene;
                model.rotation.y = 0; 
                model.scale.set(modelScale * 3.0, modelScale * 3.0, modelScale * 3.0); 
                model.position.set(0, 6, 2.0); 
                sleighGroup.add(model);
            });

            loader.load('reindeer.glb', function (gltf) {
                const deer1 = gltf.scene.clone();
                deer1.scale.set(modelScale, modelScale, modelScale);
                deer1.rotation.y = 0; 
                deer1.position.set(-3, 0, 15); 
                sleighGroup.add(deer1);

                const deer2 = gltf.scene.clone();
                deer2.scale.set(modelScale, modelScale, modelScale);
                deer2.rotation.y = 0; 
                deer2.position.set(3, 0, 15); 
                sleighGroup.add(deer2);
            });

            // Gƒ∞Rƒ∞≈û VE √áIKI≈û YOLLARI
            const entryPoints = [
                new THREE.Vector3(200, 20, -700), new THREE.Vector3(5, 5, 20), new THREE.Vector3(-50, 15, 60)    
            ];
            entryPath = new THREE.CatmullRomCurve3(entryPoints);

            const exitPoints = [
                new THREE.Vector3(-50, 15, 60), new THREE.Vector3(-100, 20, 100), new THREE.Vector3(300, 50, 500)   
            ];
            exitPath = new THREE.CatmullRomCurve3(exitPoints);

            // ZAFER YOLU (Celebration Path)
            const victoryPoints = [
                new THREE.Vector3(-400, 40, -100), new THREE.Vector3(0, 30, 20), new THREE.Vector3(400, 60, -100)
            ];
            victoryPath = new THREE.CatmullRomCurve3(victoryPoints);

            animationStartTime = performance.now();
            sleighGroup.position.copy(entryPath.getPoint(0)); 
            
            updateCameraByScreenSize();
            animate3D();
        }

        // PANKART OLU≈ûTURMA (Canvas Texture)
        function createBanner() {
            const canvas = document.createElement('canvas');
            canvas.width = 1024; canvas.height = 256;
            const ctx = canvas.getContext('2d');
            
            // Arka Plan (Beyaz Kuma≈ü)
            ctx.fillStyle = '#f0f0f0'; ctx.fillRect(0, 0, 1024, 256);
            
            // Kƒ±rmƒ±zƒ± Kenar
            ctx.lineWidth = 10; ctx.strokeStyle = '#d32f2f'; ctx.strokeRect(0,0,1024,256);

            // Yazƒ±
            ctx.fillStyle = '#d32f2f';
            ctx.font = 'bold 120px "Arial"';
            ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
            ctx.fillText("MUTLU YILLAR", 512, 128);

            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.MeshBasicMaterial({ map: texture, side: THREE.DoubleSide });
            const geometry = new THREE.PlaneGeometry(30, 7.5); // Boyut
            const banner = new THREE.Mesh(geometry, material);
            
            // Kƒ±zaƒüƒ±n arkasƒ±na yerle≈ütir
            banner.position.set(0, 5, 25); 
            banner.rotation.y = Math.PI; // Yazƒ± arkaya baksƒ±n (Geyiklerin arkasƒ±ndan okunacak)
            return banner;
        }

        // HAVAƒ∞ Fƒ∞≈ûEK PAR√áACIƒûI OLU≈ûTUR
        function createFirework() {
            const geometry = new THREE.BufferGeometry();
            const count = 200; // Par√ßacƒ±k sayƒ±sƒ±
            const positions = new Float32Array(count * 3);
            const colors = new Float32Array(count * 3);
            const color = new THREE.Color();
            color.setHSL(Math.random(), 1.0, 0.5); // Rastgele renk

            // Patlama Merkezi
            const startX = (Math.random() - 0.5) * 200;
            const startY = Math.random() * 50 + 20;
            const startZ = (Math.random() - 0.5) * 100 - 50;

            for(let i=0; i<count; i++) {
                positions[i*3] = startX;
                positions[i*3+1] = startY;
                positions[i*3+2] = startZ;
                colors[i*3] = color.r; colors[i*3+1] = color.g; colors[i*3+2] = color.b;
            }

            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

            const material = new THREE.PointsMaterial({ size: 1.5, vertexColors: true, transparent: true, opacity: 1 });
            const points = new THREE.Points(geometry, material);
            
            // Hƒ±z vekt√∂rleri (Patlama y√∂n√º)
            points.userData = { velocities: [] };
            for(let i=0; i<count; i++) {
                points.userData.velocities.push({
                    x: (Math.random() - 0.5) * 2,
                    y: (Math.random() - 0.5) * 2,
                    z: (Math.random() - 0.5) * 2
                });
            }
            points.userData.life = 1.0; // Ya≈üam s√ºresi

            scene.add(points);
            fireworks.push(points);
        }

        // KUTLAMA MODU BA≈ûLATICI
        function initCelebrationMode() {
            isCelebration = true;
            animationState = 4; // Zafer Turu Modu
            animationStartTime = performance.now();
            sleighGroup.visible = true;
            
            // Pankartƒ± ekle
            const banner = createBanner();
            sleighGroup.add(banner);
        }

        function animate3D() {
            requestAnimationFrame(animate3D);
            
            // Havai Fi≈üek G√ºncellemesi (Sadece kutlamada)
            if (isCelebration) {
                // Rastgele yeni fi≈üek at
                if (Math.random() > 0.95) createFirework();

                for (let i = fireworks.length - 1; i >= 0; i--) {
                    const fw = fireworks[i];
                    const positions = fw.geometry.attributes.position.array;
                    fw.userData.life -= 0.01;
                    fw.material.opacity = fw.userData.life;

                    for(let j=0; j < 200; j++) {
                        positions[j*3] += fw.userData.velocities[j].x;
                        positions[j*3+1] += fw.userData.velocities[j].y;
                        positions[j*3+2] += fw.userData.velocities[j].z;
                        fw.userData.velocities[j].y -= 0.02; // Yer√ßekimi
                    }
                    fw.geometry.attributes.position.needsUpdate = true;

                    if(fw.userData.life <= 0) {
                        scene.remove(fw);
                        fireworks.splice(i, 1);
                    }
                }
            }

            if (animationState === 3 && !isCelebration) return; // √áƒ±kƒ±≈ü bitti, kutlama yoksa dur

            const currentTime = performance.now();
            
            if (animationState === 0) { // Gƒ∞Rƒ∞≈û
                const elapsed = (currentTime - animationStartTime) / 1000;
                let t = elapsed / 20; 
                if (t >= 1) { t = 1; animationState = 1; waitStartTime = currentTime; }
                t = t * t * (3 - 2 * t);
                const pos = entryPath.getPoint(t);
                sleighGroup.position.copy(pos);
                if (t < 0.99) {
                    const tangent = entryPath.getTangent(t).normalize();
                    sleighGroup.lookAt(sleighGroup.position.clone().add(tangent));
                }

            } else if (animationState === 1) { // BEKLEME
                if (currentTime - waitStartTime > 5000) {
                    animationState = 2; animationStartTime = currentTime; 
                }

            } else if (animationState === 2) { // √áIKI≈û
                const elapsed = (currentTime - animationStartTime) / 1000;
                let t = elapsed / 8; 
                if (t >= 1) { t = 1; animationState = 3; sleighGroup.visible = false; }
                t = t * t;
                const pos = exitPath.getPoint(t);
                sleighGroup.position.copy(pos);
                if (t < 0.99) {
                    const tangent = exitPath.getTangent(t).normalize();
                    sleighGroup.lookAt(sleighGroup.position.clone().add(tangent));
                }
            
            } else if (animationState === 4) { // ZAFER TURU (KUTLAMA)
                const elapsed = (currentTime - animationStartTime) / 1000;
                let t = (elapsed / 15) % 1; // S√ºrekli d√∂n (Loop)
                
                const pos = victoryPath.getPoint(t);
                sleighGroup.position.copy(pos);
                const tangent = victoryPath.getTangent(t).normalize();
                sleighGroup.lookAt(sleighGroup.position.clone().add(tangent));
            }

            renderer.render(scene, camera);
        }

        function updateCameraByScreenSize() {
            if (!camera || !renderer) return;
            const width = window.innerWidth;
            const height = window.innerHeight;
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
            if (width < 768) { camera.position.set(0, 5, 90); } else { camera.position.set(0, 5, 50); }
        }
        window.addEventListener('resize', updateCameraByScreenSize);

        document.addEventListener('mousemove', function(e) {
            if(Math.random() > 0.6) return; 
            const dust = document.createElement('div');
            dust.className = 'magic-dust';
            dust.style.left = e.clientX + 'px'; dust.style.top = e.clientY + 'px';
            document.body.appendChild(dust);
            setTimeout(() => { dust.remove(); }, 1000);
        });

        document.querySelectorAll('.gift-item').forEach(gift => {
            gift.addEventListener('click', function(e) {
                const rect = gift.getBoundingClientRect();
                const x = rect.left + rect.width / 2;
                const y = rect.top + rect.height / 2;
                confetti({
                    particleCount: 30, spread: 60, origin: { x: x / window.innerWidth, y: y / window.innerHeight },
                    colors: ['#ff0000', '#00ff00', '#ffd700', '#ffffff'], shapes: ['circle', 'square'], scalar: 0.7, zIndex: 200
                });
                gift.style.transform = "scale(0) rotate(180deg)";
                gift.style.opacity = "0";
                gift.style.pointerEvents = "none"; 
                setTimeout(() => {
                    gift.style.transform = ""; gift.style.opacity = ""; gift.style.pointerEvents = "auto";
                    gift.classList.add('gift-respawn');
                    setTimeout(() => { gift.classList.remove('gift-respawn'); }, 600);
                }, 1000);
            });
        });
    </script>
</body>
</html>
